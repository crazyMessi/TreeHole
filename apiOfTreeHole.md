[TOC]

| 修订版本号 | 修订时间      | 修订人员 |      |
| ---------- | ------------- | -------- | ---- |
| 4.0        | 2019年12月3日 | 李卓栋   |      |

## 0.本次修订内容：

基本完成了所有功能 但防错措施尚未完善 **欢迎前端恶意设置参数**

[^1]:在备注中增加了对code的解释
[^2]:增加可选的传入参数："歌名"

## 一.基本配置

### 1.备注

- 测试使用的`BaseURL` :  http://lizhuodong.xyz:8380/login `

- 所有服务器返回数据均为`json`（即服务器返回数据的Content-Type为`application/json`)

- 若返回参数类型为object,则表示这是个对象（可能不完整，若不完整，会在备注中说明，负责该对象完整），需前端在“2.用到的对象中”中查看其属性，并用json语法提取其中需要用到的信息

- 若本次请求正常，则返回`code`为0，`message`为“success”；code小于0代表错误, 大于0代表非错误性提示。

- 注：code的取值及**可能**情况[^1]：

  | code | 说明                                               | 备注                                   |
  | ---- | -------------------------------------------------- | -------------------------------------- |
  |      | 所请求的数据为空                                   |                                        |
  | -1   | 传入参数有误（参数名不正确、参数为空值）、其他问题 | 有可能是后端的问题                     |
  | -2   | 传入参数的值错误（密码、口令错误）                 | 同上                                   |
  | -3   | 后端处理时出错                                     | 肯定是后端的问题，请及时截图并联系后端 |

  

### 2.用到的对象

#### 1）心情（feeling）：

| 中文名称               | 变量名(value) | 类型      |                            |
| ---------------------- | ------------- | --------- | -------------------------- |
| “心情”序号（递增主键） | feelingId     | int       |                            |
| 内容                   | feelContent   | string    |                            |
| 私密性                 | ifPrivate     | string    |                            |
| 发布日期               | feUpdateTime  | timestamp |                            |
| 发布人Id               | userId        | string    |                            |
| 评论数                 | commentCount  | int       |                            |
| 集赞数                 | supportCount  | int       |                            |
| 当前用户是否点赞       | ifSupport     | String    | 可能值有“已点赞”、“未点赞” |

#### 2）评论（comment）：

| 中文名称               | 变量名(value) | 类型      |
| ---------------------- | ------------- | --------- |
| 所评论的目标的id(外键) | id            | int       |
| 评论本身的id           | commentId     | int       |
| 评论内容               | comContent    | string    |
| 评论时间               | comUpdateTime | timeStamp |
| 评论者的Id             | userId        | string    |
| 所评论的目标[^11]      | type          | String    |
| 楼数[^9]               | commentCount  | long      |

#### 3)推普适性的话(saying)：

| 中文名称         | 变量名       | 类型   |             |
| ---------------- | ------------ | ------ | ----------- |
| 话的id           | sayingId     | string |             |
| 标签（外键）     | tag          | string |             |
| 内容             | content      | string |             |
| 集赞数           | supportCount | int    |             |
| 评论数           | commentCount | int    |             |
| 附带图片的路径   | imgUrl       | string |             |
| 当前用户是否点赞 | ifSupport    | string | 同”feeling“ |

#### 4）用户信息（userinformation)：

| 中文名称 | 变量名    | 类型   | 备注                              |
| -------- | --------- | ------ | --------------------------------- |
| 用户id   | userId    | string |                                   |
| 用户头像 | userPhoto | string | 用户头像的url。未设置时为一默认值 |
|          |           |        |                                   |

#### 5）推歌（Music）：

| 中文名称        | 变量名(value) | 类型   |
| --------------- | ------------- | ------ |
| 路径            | musicUrl      | string |
| 歌名            | musicName     | string |
| 歌曲id          | musicId       | int    |
| 标签（外键）    | tag           | string |
| 附带的图片的url | imgUrl        | string |

## 二.登陆：

登陆  ：

| url           | method |
| ------------- | ------ |
| /loginServlet | post   |

传入参数：

| 参数         | 参数名   | 说明                 |
| :----------- | :------- | :------------------- |
| 学生帐号     | userId   | 提示："学生学号"     |
| 统一认证密码 | password | 提示："统一认证密码" |

传出参数：

| 中文名   | 参数名          | 参数类型 | 备注             |
| -------- | --------------- | -------- | ---------------- |
| 消息     | message         | string   |                  |
| 返回码   | code            | int      |                  |
| 用户信息 | userinformation | object   | 用户头像为默认值 |

```
//
```



## 三.操作

#### 1.扔进树洞

| url                | method |
| ------------------ | ------ |
| /toTreeHoleServlet | post   |

传入参数：

| 中文名       | 参数名 | 备注                                      |
| ------------ | ------ | ----------------------------------------- |
| 标签         | tag    |                                           |
| 传出参数类型 | type   | ”1“表示请求传出参数1,"2"表示请求传出参数2 |

传出参数1：普适性的话

| 中文名     | 参数名  | 参数类型 | 备注 |
| ---------- | ------- | -------- | ---- |
| 消息       | message | string   |      |
| 返回码     | code    | code     |      |
| 普适性的话 | saying  | object   |      |

传出参数2：推歌

| 中文名 | 参数名  | 参数类型 | 备注              |
| ------ | ------- | -------- | ----------------- |
| 消息   | message | string   |                   |
| 返回码 | code    | code     |                   |
| 歌     | music   | object   | 推歌对象（Music） |

#### 2.分享今日"心情"

| url                | method |
| ------------------ | ------ |
| /shareTodayServlet |        |

传入参数：

| 中文名 | 参数名    | 备注                       |
| ------ | --------- | -------------------------- |
| 内容   | content   |                            |
| 隐私性 | ifPrivate | "1“表示可见，"0"表示不可见 |

传出参数：

| 中文名 | 参数名  | 参数类型 |
| ------ | ------- | -------- |
| “心情” | feeling | object   |
| 消息   | message | string   |
| 返回码 | code    | int      |

#### 3.查看我的心情

| url                    | method |
| ---------------------- | ------ |
| /viewMyfeelingsServlet | post   |

传入参数：

| 中文名 | 参数名    | 备注                             |
| ------ | --------- | -------------------------------- |
| 时限   | timeLimit | ("1","3","10"分别代表1、3、10天) |

传出参数：

| 中文名称   | 参数名      | 类型           |
| ---------- | ----------- | -------------- |
| “心情列表” | feelingList | List\<feeling> |



#### 4.点赞（心情&普适性的话）

| url             | method | 备注             |
| --------------- | ------ | ---------------- |
| /supportServlet | post   | 给”心情“点赞     |
| 同上            | post   | 给普适性的话点赞 |

传入参数：

| 中文名 | 参数名             | 备注                         |
| ------ | ------------------ | ---------------------------- |
| id     | feelingId&sayingId | 所点赞的对象的id             |
| 点赞   | ifSupport          | “1”表示点赞，”2“表示取消点赞 |

传出参数：

| 中文名 | 参数名  | 参数类型 | 备注 |
| ------ | ------- | -------- | ---- |
| 消息   | message | string   |      |
| 返回码 | code    | code     |      |

#### 5.评论（心情&普适性的话）

| url             | method | 备注               |
| --------------- | ------ | ------------------ |
| /commentServlet | post   | 给“心情”评论       |
| 同上            | post   | 给推普适性的话评论 |

传入参数：

| 中文名           | 参数名                |      |
| ---------------- | --------------------- | ---- |
| 评论内容         | comContent            |      |
| 所评论的帖子的Id | sayingId\|\|feelingId |      |

传出参数：

| 中文名 | 参数名  | 参数类型 | 备注 |
| ------ | ------- | -------- | ---- |
| 消息   | message | string   |      |
| 返回码 | code    | int      |      |
| 评论   | comment | object   |      |

#### 6.删除”心情“

| url                     | method |
| ----------------------- | ------ |
| /delectMyfeelingServlet | post   |

传入参数：

| 中文名   | 参数名    |      |
| -------- | --------- | ---- |
| ”心情“id | feelingId |      |

传出参数：

| 中文名 | 参数名  | 参数类型 | 备注 |
| ------ | ------- | -------- | ---- |
| 消息   | message | string   |      |
| 返回码 | code    | int      |      |

#### 7.更换头像



| url                    | method |
| ---------------------- | ------ |
| /changUserPhotoServlet | post   |

传入参数：

| 中文名   | 参数名 | 备注         |
| -------- | ------ | ------------ |
| 文件路径 | file   | 名字不带中文 |

传出参数：

| 中文名   | 参数名          | 参数类型 | 备注 |
| -------- | --------------- | -------- | ---- |
| 消息     | message         | string   |      |
| 返回码   | code            | int      |      |
| 用户信息 | userinformation | object   |      |

#### 8.查看ta的心情：

| url                        | method |
| -------------------------- | ------ |
| /viewOthersFeelingsServlet | post   |

传入参数：

| 中文名   | 参数名 | 备注                    |
| -------- | ------ | ----------------------- |
| 页码     | page   | 从0开始                 |
| 每页数量 | limit  | 最大值5，最小值1，默认2 |

传出参数：

| 中文名   | 参数名      | 备注                               |
| -------- | ----------- | ---------------------------------- |
| 心情列表 | feelingList | List\<feeling>,内含两个feeling对象 |

#### 9.查看评论列表：

| url                 | method |
| ------------------- | ------ |
| /viewCommentServlet | post   |

| 中文名      | 参数名             | 备注 |
| ----------- | ------------------ | ---- |
| 心情&话的id | sayingId&feelingId |      |

传出参数：

| 中文名   | 参数名      | 备注           |
| -------- | ----------- | -------------- |
| 评论列表 | commentList | List\<comment> |

#### 10.添加普适性的话：

| url               | method |
| ----------------- | ------ |
| /addSayingServlet | post   |

| 中文名 | 参数名  | 备注                              |
| ------ | ------- | --------------------------------- |
| 内容   | content |                                   |
| 标签   | tag     | 英文“other、family、love、study ” |
| 图片   | file    |                                   |
| 口令   | keyword | 学生在线精彩无限                  |

传出参数

| 中文名     | 参数名  | 参数类型 |      |
| ---------- | ------- | -------- | ---- |
| 普适性的话 | saying  | object   |      |
|            | code    |          |      |
|            | message |          |      |

#### 11.添加推歌（文件接口）：

| url              | method |
| ---------------- | ------ |
| /addMusicServlet | post   |

传入参数：[^2]

| 中文名       | 参数名    | 备注                                                         |
| ------------ | --------- | ------------------------------------------------------------ |
| 歌曲文件     | file      |                                                              |
| 歌曲背景图片 | file      |                                                              |
| 标签         | tag       | 英文“other、family、love、study ”                            |
| 口令         | keyword   | 学生在线精彩无限                                             |
| 歌名         | musicName | 歌曲的名字（后端的收到文件名后会进行调整，如有需要可选择发送此参数） |

传出参数：

| 中文名 | 参数名  | 参数类型 | 备注 |
| ------ | ------- | -------- | ---- |
| 歌     | music   | object   |      |
|        | code    | int      |      |
|        | message | string   |      |